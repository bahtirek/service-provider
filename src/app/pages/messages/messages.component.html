<div class="container container-md" #messageContainer>
  <div class="flex items-center no-wrap">
    <app-back-button></app-back-button>
    <h3 class="ml-auto">{{subject.title}}</h3>
  </div>
  <div class="message-container" [ngClass]="{'new-message': containerBorder}">
    <div class="card pa-xl">
      @for (message of messages(); track message.messageId; let index = $index) {
        <app-message [userId]="user.user?.userId" [message$]="message" [receiver]="receiver" [index]="index" (onMessageIntersect)="onMessageIntersect($event)" (onAttachmentClickEmit)="onAttachmentClick($event)"></app-message>
        @if(displayDate(index, message.createdAt)){
          <div class="date-separator">{{message.createdAt | date: 'dd/MM/YYYY,  EEEE'}}</div>
        }
      }
    </div>
    <app-message-toolbar [receiverId]="receiver.receiverId"></app-message-toolbar>
  </div>
</div>
<app-attachment-modal [(modal)]="toggleImageModal">
  <img [src]="attachmentUrl" alt="">
</app-attachment-modal>
<app-attachment-modal [(modal)]="toggleVideoModal">
  <app-video [src]="attachmentUrl" ></app-video>
</app-attachment-modal>
<a class="hidden" #downloadLink></a>
